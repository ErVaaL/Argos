<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DeviceService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">argos-application</a> &gt; <a href="index.source.html" class="el_package">com.erval.argos.application.device</a> &gt; <span class="el_source">DeviceService.java</span></div><h1>DeviceService.java</h1><pre class="source lang-java linenums">package com.erval.argos.application.device;

import java.util.UUID;

import com.erval.argos.core.application.PageRequest;
import com.erval.argos.core.application.PageResult;
import com.erval.argos.core.application.port.in.commands.DeviceCommandUseCase;
import com.erval.argos.core.application.port.in.queries.DeviceQueryUseCase;
import com.erval.argos.core.application.port.in.queries.DeviceQueryUseCase.DeviceFilter;
import com.erval.argos.core.application.port.out.DeviceRepositoryPort;
import com.erval.argos.core.domain.device.Device;
import com.erval.argos.core.domain.device.DeviceType;

/**
 * Application service orchestrating device commands and queries.
 * &lt;p&gt;
 * Responsibilities:
 * &lt;ul&gt;
 * &lt;li&gt;validating and persisting device aggregates&lt;/li&gt;
 * &lt;li&gt;translating query filters into repository calls&lt;/li&gt;
 * &lt;li&gt;managing default values such as generated identifiers&lt;/li&gt;
 * &lt;/ul&gt;
 */
<span class="fc" id="L24">public record DeviceService(DeviceRepositoryPort repo) implements DeviceCommandUseCase, DeviceQueryUseCase {</span>

    /**
     * Creates a new device using the provided command data.
     * &lt;p&gt;
     * Behavior notes:
     * &lt;ul&gt;
     * &lt;li&gt;generates a random UUID for the device id&lt;/li&gt;
     * &lt;li&gt;marks the device as active by default&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * @param cmd incoming device data
     * @return the persisted device
     */
    @Override
    public Device createDevice(CreateDeviceCommand cmd) {
<span class="fc" id="L40">        String id = UUID.randomUUID().toString();</span>

<span class="fc" id="L42">        Device device = new Device(</span>
                id,
<span class="fc" id="L44">                cmd.name(),</span>
<span class="fc" id="L45">                cmd.type(),</span>
<span class="fc" id="L46">                cmd.building(),</span>
<span class="fc" id="L47">                cmd.room(),</span>
                true,
                null);

<span class="fc" id="L51">        return repo.save(device);</span>
    }

    /**
     * Removes a device by id.
     * &lt;p&gt;
     * &lt;ul&gt;
     * &lt;li&gt;silently succeeds if the id does not exist&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * @param id identifier of the device to delete
     */
    @Override
    public void deleteDevice(String id) {
<span class="nc" id="L65">        repo.deleteById(id);</span>
<span class="nc" id="L66">    }</span>

    /**
     * Updates a device with new values, keeping existing fields when a command
     * value is null.
     * &lt;p&gt;
     * Field handling rules:
     * &lt;ul&gt;
     * &lt;li&gt;non-null command values overwrite stored values&lt;/li&gt;
     * &lt;li&gt;null command values leave the existing field intact&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * @param id  identifier of the device to update
     * @param cmd incoming updates
     * @return the updated device
     * @throws IllegalArgumentException if the device does not exist
     */
    @Override
    public Device updateDevice(String id, UpdateDeviceCommand cmd) {
<span class="fc" id="L85">        Device existing = repo.findById(id).orElseThrow(() -&gt; new IllegalArgumentException(&quot;Device not found: &quot; + id));</span>

<span class="pc bpc" id="L87" title="1 of 2 branches missed.">        String name = cmd.name() != null ? cmd.name() : existing.name();</span>
<span class="pc bpc" id="L88" title="1 of 2 branches missed.">        DeviceType type = cmd.type() != null ? cmd.type() : existing.type();</span>
<span class="pc bpc" id="L89" title="1 of 2 branches missed.">        String building = cmd.building() != null ? cmd.building() : existing.building();</span>
<span class="pc bpc" id="L90" title="1 of 2 branches missed.">        String room = cmd.room() != null ? cmd.room() : existing.room();</span>
<span class="pc bpc" id="L91" title="1 of 2 branches missed.">        boolean active = cmd.active() != null ? cmd.active() : existing.active();</span>

<span class="fc" id="L93">        Device updated = new Device(</span>
<span class="fc" id="L94">                existing.id(),</span>
                name,
                type,
                building,
                room,
                active,
<span class="fc" id="L100">                existing.config());</span>

<span class="fc" id="L102">        return repo.save(updated);</span>
    }

    /**
     * Finds devices that match the given filter and pagination settings.
     * &lt;p&gt;
     * Defaults:
     * &lt;ul&gt;
     * &lt;li&gt;sorts by {@code name} when the caller omits a field&lt;/li&gt;
     * &lt;li&gt;returns empty content when no devices match the filter&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * @param filter      filter criteria (building, room, type, active flag); may
     *                    be {@code null}
     * @param pageRequest pagination and sorting parameters
     * @return matching devices wrapped in a paginated result
     */
    @Override
    public PageResult&lt;Device&gt; findDevices(DeviceFilter filter, PageRequest pageRequest) {
<span class="fc" id="L121">        return repo.findByFilter(filter, pageRequest);</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>